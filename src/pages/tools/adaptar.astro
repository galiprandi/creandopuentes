---
import Layout from '../../layouts/Layout.astro';
import { initialConversation } from '@/pages/tools/initialConversation';
import ChatMessage from '../../components/ui/ChatMessage.astro';
---

<Layout title="Chat Interface">
  <div class="chat-container">
    <div id="conversation-container" class="conversation-container">
      <div id="messages" class="messages">
        {initialConversation.map((msg) => (<ChatMessage msg={msg} />))}
      </div>
    </div>
    
    <form id="chat-form" class="chat-form">
      <textarea 
        id="user-input" 
        placeholder="Write your message..." 
        rows="1"
      ></textarea>
      <button type="submit" class="btn btn-secondary">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
        </svg>
      </button>
    </form>
  </div>
</Layout>

<style>
  .chat-container {
    display: flex;
    flex-direction: column;
    max-width: 800px;
    width: 100%;
    height: calc(100vh - 150px);
    margin: 0 auto;
  }

  .conversation-container {
    flex-grow: 1;
    overflow-y: auto;
    padding: 1rem;
  }

  .messages {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  .message {
    max-width: 80%;
    padding: 0.5em 1em;
    border-radius: 1em;
    line-height: 1.4;
  }

  .message.user {
    align-self: flex-end;
    background-color: #f5f5f5;
    margin-left: auto;
  }

  .message.assistant {
    align-self: flex-start;
    background-color: #d1f7c4;
  }

  .chat-form {
    display: flex;
    padding: 1rem;
    border-top: 1px solid #e5e7eb;
  }

  .chat-form textarea {
    flex-grow: 1;
    padding: 0.75rem;
    border: 1px solid #e5e7eb;
    border-radius: 0.5rem;
    resize: none;
    max-height: 200px;
  }

  .chat-form button {
    border: none;
    border-radius: 0.5rem;
    margin-left: 0.5rem;
    padding: 0.5rem;
    cursor: pointer;
  }
</style>

<script>

  document.getElementById('chat-form')?.addEventListener('submit', (e) => {
    e.preventDefault();
    const input = document.getElementById('user-input') as HTMLTextAreaElement;
    const message = input.value.trim();
    console.log();
    
    if (message) {
      const messagesContainer = document.getElementById('messages');
      const userMessageEl = document.createElement('div');
      userMessageEl.className = 'message user';
      
      const contentEl = document.createElement('div');
      contentEl.className = 'message-content prose';
      
      contentEl.innerHTML = message;
      
      userMessageEl.appendChild(contentEl);
      messagesContainer?.appendChild(userMessageEl);
      
      input.value = '';
      input.style.height = 'auto';
    }
  });
</script>